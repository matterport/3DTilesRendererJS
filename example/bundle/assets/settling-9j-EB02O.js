import{aI as D,k as P,l as g,b3 as W,V as z,R as B,ad as V,i as J}from"./three.module-D7KO9fW1.js";import{r as c,u as w,d as S,h as N,a as L,i as $,j as a,c as H,C as K,T as X,b as j,G as Y}from"./CameraControls-C_dGbRZA.js";import{D as Z}from"./DRACOLoader-CyVf0s8X.js";import{u as ee,T as te}from"./leva.esm-DJitr2vz.js";import{C as se,T as ne}from"./TilesLoadingBar-C7yqvJJ3.js";import{C as re}from"./CameraViewTransition-vl0gLBim.js";import{C as ie}from"./CesiumIonAuthPlugin-BTmff_I6.js";import{G as oe}from"./GLTFExtensionsPlugin-D_84q433.js";import{T as ae}from"./TileCompressionPlugin-DG3B0Sla.js";import{U as le}from"./UpdateOnChangePlugin-6mkQA8gE.js";import{T as ue}from"./TilesFadePlugin-B4jUXJFT.js";import{E as ce,O as G}from"./Ellipsoid-CsJ1QeYU.js";import{E as de}from"./Environment-CMgwsv8E.js";import"./EnvironmentControls-BoG6cGNa.js";import"./GlobeControls-BtrJAIFV.js";import"./TilesRenderer-BBgP2cW1.js";import"./I3DMLoader-BqzkgmWd.js";import"./readMagicBytes-B3HEinov.js";import"./GLTFLoader-CtPRlX4X.js";import"./B3DMLoader-DI0Nnorf.js";import"./PNTSLoader-37LQDqUT.js";import"./CMPTLoader-CjPO0L4d.js";import"./EllipsoidRegion-b1k67aVx.js";import"./CanvasDOMOverlay-BOt5d168.js";import"./extends-CF3RwP-h.js";import"./CameraTransitionManager-BDu6ZRDV.js";import"./EPSGTilesPlugin-BLbCEnRQ.js";import"./TiledImageSource-ERPSo-Ic.js";function U(...h){return c.useCallback(e=>{h.forEach(t=>{t&&(typeof t=="function"?t(e):t.current=e)})},h)}function F(h,e){e(h)||h.children.forEach(t=>{F(t,e)})}class pe extends D{constructor(){super(),this.objects=new Set,this.observed=new Set,this._addedCallback=({child:e})=>{F(e,t=>this.observed.has(t)?!0:(this.objects.add(t),t.addEventListener("childadded",this._addedCallback),t.addEventListener("childremoved",this._removedCallback),this.dispatchEvent({type:"childadded",child:e}),!1))},this._removedCallback=({child:e})=>{F(e,t=>this.observed.has(t)?!0:(this.objects.delete(t),t.removeEventListener("childadded",this._addedCallback),t.removeEventListener("childremoved",this._removedCallback),this.dispatchEvent({type:"childremoved",child:e}),!1))}}observe(e){const{observed:t}=this;this._addedCallback({child:e}),t.add(e)}unobserve(e){const{observed:t}=this;t.delete(e),this._removedCallback({child:e})}dispose(){this.observed.forEach(e=>{this.unobserve(e)})}}const _=new B,q=new W,C=new W,A=new z,E=new g,O=new P;class me extends D{constructor(){super(),this.autoRun=!0,this.queryMap=new Map,this.index=0,this.queued=[],this.scheduled=!1,this.duration=1,this.objects=[],this.observer=new pe,this.ellipsoid=new ce,this.frame=new P,this.cameras=new Set;const e=(()=>{let t=!1;return()=>{t||(t=!0,queueMicrotask(()=>{this.queryMap.forEach(r=>this._enqueue(r)),t=!1}))}})();this.observer.addEventListener("childadded",e),this.observer.addEventListener("childremoved",e)}_enqueue(e){e.queued||(this.queued.push(e),e.queued=!0,this._scheduleRun())}_runJobs(){const{queued:e,cameras:t,duration:r}=this,s=performance.now();for(t.forEach((n,l)=>{O.copy(n.matrixWorldInverse).premultiply(n.projectionMatrix),E.set(0,0,-1).transformDirection(n.matrixWorld),q.start.setFromMatrixPosition(n.matrixWorld),q.end.addVectors(E,q.start);for(let d=0,i=e.length;d<i;d++){const o=e[d],{ray:p}=o;let y,u;if(o.point===null)C.start.copy(p.origin),p.at(1,C.end),he(q,C,A),o.distance=A.x*(1-Math.abs(E.dot(p.direction))),o.inFrustum=!0;else{const m=C.start;m.copy(o.point).applyMatrix4(O),m.x>-1&&m.x<1&&m.y>-1&&m.y<1&&m.z>-1&&m.z<1?(o.distance=m.subVectors(o.point,q.start).dot(E),o.inFrustum=!0):(o.distance=0,o.inFrustum=!1)}l===0?(o.distance=y,o.inFrustum=u):(o.inFrustum=o.inFrustum||u,o.distance=Math.min(o.distance,y))}}),t.length!==0&&e.sort((n,l)=>n.point===null!=(l.point===null)?n.point===null?1:-1:n.inFrustum!==l.inFrustum?n.inFrustum?1:-1:n.distance<0!=l.distance<0?n.distance<0?-1:1:l.distance-n.distance);e.length!==0&&performance.now()-s<r;){const n=e.pop();n.queued=!1,this._updateQuery(n)}e.length!==0&&this._scheduleRun()}_scheduleRun(){this.autoRun&&!this.scheduled&&(this.scheduled=!0,requestAnimationFrame(()=>{this.scheduled=!1,this._runJobs()}))}_updateQuery(e){_.ray.copy(e.ray),_.far="lat"in e?1e4+Math.max(...this.ellipsoid.radius):1/0;const t=_.intersectObjects(this.objects)[0]||null;t!==null&&(e.point===null?e.point=t.point.clone():e.point.copy(t.point)),e.callback(t)}addCamera(e){const{queryMap:t,cameras:r}=this;r.add(e),t.forEach(s=>this._enqueue(s))}deleteCamera(e){const{cameras:t}=this;t.delete(e)}runIfNeeded(e){const{queryMap:t,queued:r}=this,s=t.get(e);s.queued&&(this._updateQuery(s),s.queued=!1,r.splice(r.indexOf(s),1))}setScene(...e){const{observer:t}=this;t.dispose(),e.forEach(r=>t.observe(r)),this.objects=e,this._scheduleRun()}setEllipsoidFromTilesRenderer(e){const{queryMap:t,ellipsoid:r,frame:s}=this;(!r.radius.equals(e.ellipsoid.radius)||!s.equals(e.group.matrixWorld))&&(r.copy(e.ellipsoid),s.copy(e.group.matrixWorld),t.forEach(n=>{if("lat"in n){const{lat:l,lon:d,ray:i}=n;r.getCartographicToPosition(l,d,1e4,i.origin).applyMatrix4(s),r.getCartographicToNormal(l,d,i.direction).transformDirection(s).multiplyScalar(-1)}this._enqueue(n)}))}registerRayQuery(e,t){const r=this.index++,s={ray:e.clone(),callback:t,queued:!1,distance:-1,point:null};return this.queryMap.set(r,s),this._enqueue(s),r}registerLatLonQuery(e,t,r){const{ellipsoid:s,frame:n}=this,l=this.index++,d=new V;s.getCartographicToPosition(e,t,1e4,d.origin).applyMatrix4(n),s.getCartographicToNormal(e,t,d.direction).transformDirection(n).multiplyScalar(-1);const i={ray:d.clone(),lat:e,lon:t,callback:r,queued:!1,distance:-1,point:null};return this.queryMap.set(l,i),this._enqueue(i),l}unregisterQuery(e){const{queued:t,queryMap:r}=this,s=r.get(e);r.delete(e),s&&s.queued&&(s.queued=!1,t.splice(t.indexOf(s),1))}dispose(){this.queryMap.clear(),this.queued.length=0,this.objects.length=0,this.observer.dispose()}}const he=function(){const h=new g,e=new g,t=new g;return function(s,n,l){const d=s.start,i=h,o=n.start,p=e;t.subVectors(d,o),h.subVectors(s.end,s.start),e.subVectors(n.end,n.start);const y=t.dot(p),u=p.dot(i),m=p.dot(p),x=t.dot(i),f=i.dot(i)*m-u*u;let b,M;f!==0?b=(y*u-x*m)/f:b=0,M=(y+b*u)/m,l.x=b,l.y=M}}(),k=c.createContext(null),R=new P,T=new V,fe=c.forwardRef(function(e,t){const{interpolationFactor:r=.025,onQueryUpdate:s=null,...n}=e,l=c.useContext(S),d=c.useContext(k),i=w(({invalidate:x})=>x),o=c.useMemo(()=>new g,[]),p=c.useMemo(()=>({value:!1}),[]),y=c.useMemo(()=>({value:!1}),[]),u=c.useRef(null),m=c.useCallback(x=>{if(l===null||x===null||u.current===null)return;const{lat:v,lon:f,rayorigin:b,raydirection:M}=n;v!==null&&f!==null?(o.copy(x.point),y.value=!0,d.ellipsoid.getRotationMatrixFromAzElRoll(v,f,0,0,0,R,G).premultiply(l.group.matrixWorld),u.current.quaternion.setFromRotationMatrix(R),i()):b!==null&&M!==null&&(o.copy(x.point),y.value=!0,u.current.quaternion.identity(),i()),s&&s(x)},[i,y,d.ellipsoid,n,o,l,s]);return L((x,v)=>{if(u.current&&(u.current.visible=p.value),u.current&&y.value)if(p.value===!1)p.value=!0,u.current.position.copy(o);else{const f=1-2**(-v/r);u.current.position.distanceToSquared(o)>1e-6?(u.current.position.lerp(o,r===0?1:f),i()):u.current.position.copy(o)}}),a.jsx(ye,{ref:U(u,t),onQueryUpdate:m,...n})}),ye=c.forwardRef(function(e,t){const{component:r=a.jsx("group",{}),lat:s=null,lon:n=null,rayorigin:l=null,raydirection:d=null,onQueryUpdate:i=null,...o}=e,p=c.useRef(null),y=c.useContext(S),u=c.useContext(k),m=w(({invalidate:v})=>v),x=c.useMemo(()=>new g,[]);return c.useEffect(()=>{const v=f=>{i?i(f):y&&f!==null&&p.current!==null&&(s!==null&&n!==null?(p.current.position.copy(f.point),u.ellipsoid.getRotationMatrixFromAzElRoll(s,n,0,0,0,R,G).premultiply(y.group.matrixWorld),p.current.quaternion.setFromRotationMatrix(R),m()):l!==null&&d!==null&&(p.current.position.copy(f.point),p.current.quaternion.identity(),m()))};if(s!==null&&n!==null){const f=u.registerLatLonQuery(s,n,v);return()=>u.unregisterQuery(f)}else if(l!==null&&d!==null){T.origin.copy(l),T.direction.copy(d);const f=u.registerRayQuery(T,v);return()=>u.unregisterQuery(f)}},[s,n,l,d,u,y,m,x,i]),c.cloneElement(r,{...o,ref:U(p,t),raycast:()=>!1})}),xe=c.forwardRef(function(e,t){const r=w(({scene:p})=>p),{scene:s=r,children:n,...l}=e,d=c.useContext(S),i=c.useMemo(()=>new me,[]),o=w(({camera:p})=>p);return N(i,l),c.useEffect(()=>()=>i.dispose(),[i]),c.useEffect(()=>{i.setScene(...Array.isArray(s)?s:[s])},[i,s]),c.useEffect(()=>{i.addCamera(o)},[i,o]),L(()=>{d&&i.setEllipsoidFromTilesRenderer(d)}),$(i,t),a.jsx(k.Provider,{value:i,children:a.jsx("group",{matrixAutoUpdate:!1,matrixWorldAutoUpdate:!1,children:n})})}),ve=new Z().setDecoderPath("https://www.gstatic.com/draco/v1/decoders/"),Q=new g,I=new g;function ge(h){const e=c.useRef();return L(({camera:t})=>{const r=e.current;let s;t.isPerspectiveCamera?(Q.setFromMatrixPosition(t.matrixWorld),I.setFromMatrixPosition(r.matrixWorld),s=.05*Q.distanceTo(I)*Math.atan(t.fov*J.DEG2RAD)):s=(t.top-t.bottom)*.05/t.zoom,s=Math.min(Math.max(s,100),2e5),r.scale.setScalar(s*.5)}),a.jsxs(fe,{ref:e,...h,children:[a.jsxs("mesh",{"position-y":1.25,scale:.5,children:[a.jsx("sphereGeometry",{}),a.jsx("meshStandardMaterial",{color:16007990,emissive:16007990,emissiveIntensity:.25})]}),a.jsxs("mesh",{"position-y":.5,scale:[.1,1,.1],children:[a.jsx("cylinderGeometry",{}),a.jsx("meshStandardMaterial",{color:16007990,emissive:16007990,emissiveIntensity:.25})]})]})}function be(){const h={ortho:!1},e=new Array(500).fill().map((r,s)=>{const n=-Math.PI/2+Math.PI*s/500,l=s;return a.jsx(ge,{lat:n,lon:l,scale:.1},s)}),{ortho:t}=ee(h);return a.jsxs(K,{frameloop:"demand",camera:{position:[0,.5*1e7,1.5*1e7]},style:{width:"100%",height:"100%",position:"absolute",margin:0,left:0,top:0},flat:!0,children:[a.jsx("color",{attach:"background",args:[1118481]}),a.jsxs(X,{group:{rotation:[-Math.PI/2,0,0]},children:[a.jsx(j,{plugin:ie,args:{apiToken:"",assetId:"2275207",autoRefreshToken:!0}}),a.jsx(j,{plugin:oe,dracoLoader:ve}),a.jsx(j,{plugin:ae}),a.jsx(j,{plugin:le}),a.jsx(j,{plugin:ue}),a.jsx(Y,{enableDamping:!0}),a.jsx(re,{mode:t?"orthographic":"perspective"}),a.jsx(te,{}),a.jsx(se,{}),a.jsx(ne,{}),a.jsx(xe,{children:e})]}),a.jsx(de,{preset:"sunset",backgroundBlurriness:.9,environmentIntensity:1})]})}H.createRoot(document.getElementById("root")).render(a.jsx(c.StrictMode,{children:a.jsx(be,{})}));
